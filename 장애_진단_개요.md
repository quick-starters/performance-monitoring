# 장애 진단 개요

점점 규모가 커져갈 서비스를 위한 전반적으로 장애를 처리 과정을 정리해보자.

> ⚠️ **WAS를 그냥 재시작하면 안되나요?**
>
> 차근차근 상황에 대해 냉철하게 확인할 필요가 있다. 아무런 설명도 듣지 않고, 여기저기 쑤셔보다가는 오히려 시간만 낭비하기 십상인데다 전혀 근거도 남기지 않고 WAS를 재시작해버리면 원인 파악이 힘들어 진다.



## 진단 요청(장애 발생) 처리 순서

1. 장애 유형 확인(인터뷰나 메일을 통한 증상 확인)
2. 시스템 기본 정보 확인
3. 각종 데이터를 통한 원인 진단
4. 원인이 발견되었을 경우, 장애 원인 제거 후 확인
5. 진단 결과 보고서 작성 (필요할 경우)



### 1. 장애 유형 파악

진단할 때 가장 먼저 해야 할 일은 장애의 유형을 살펴보는 것이다. 특정 유형에 따라 필요한 진단 절차가 달라진다.

| 대분류                  | 소분류                                                  |
| ----------------------- | ------------------------------------------------------- |
| 시스템이 느려요.        | 전체 시스템이 항상 느린 경우                            |
|                         | 특정 기능이 느린 경우                                   |
|                         | 특정 시간대(기간)에 전체 애플리케이션이 느린 경우       |
|                         | 특정 시간대(기간)에 특정 애플리케이션이 느린 경우       |
|                         | 특정 기능이 점점 느려질 경우                            |
|                         | 특정 사용자만 애플리케이션이 느린 경우                  |
| 시스템이 응답이 없어요. | 모든 애플리케이션이 응답하지 않는 경우                  |
|                         | 특정 기능이 응답하지 않는 경우                          |
| 예외가 계속 발생해요.   | 모든 사용자가 특정 기능을 수행하면 예외가 발생하는 경우 |
|                         | 특정 사용자의 특정 기능에서만 예외가 발생하는 경우      |
|                         | 특정 시간대에 전체 애플리케이션에 예외가 발생하는 경우  |
|                         | 특정 시간대에 특정 애플리케이션에 예외가 발생하는 경우  |
| 시스템이 죽어요.        | 실마리가 있는 경우                                      |
|                         | 아무 실마리도 없이 죽는 경우                            |



### 2. 시스템 기본 정보 파악

어떤 장애가 나건 적어도 다음 표의 자료에 대해서는 파악할 수 있어야한다.

| 구분            | 조사 내용                                                    |
| --------------- | ------------------------------------------------------------ |
| 장애 현상       | 어떤 문제가 발생했는지에 대한 정보                           |
| 모니터링 시스템 | 모니터링 시스템 여부                                         |
|                 | 모니터링 시스템의 URL 또는 접근 방법 확인                    |
| Java 정보       | 자바 버전                                                    |
|                 | JDK 설치 위치                                                |
| 웹 서버 정보    | 웹 서버 종류                                                 |
|                 | 웹 서버 설치 위치                                            |
|                 | 웹 로그(access 로그) 위치                                    |
| WAS 정보        | WAS 종류                                                     |
|                 | WAS 설치 위치                                                |
|                 | WAS 설정 파일 위치(온갖 설정 파일의 위치)                    |
|                 | 도메인 설치 위치(애플리케이션의 클래스 및 라이브러리, 화면 관련 파일의 위치) |
|                 | 로그 파일의 위치                                             |
| DB 정보         | DBMS의 종류                                                  |
|                 | DB의 설치 위치                                               |
|                 | DB 관련 설정 파일 위치                                       |
| 기타 정보       | 연계 시스템 여부                                             |
|                 | 연계 시스템의 위치                                           |
|                 | 각 서버의 로그인 계정                                        |
|                 | 작업할 장소의 IP                                             |



### 3. 각종 데이터를 통한 원인 진단

#### 최상의 조건

다음 세 가지 조건이 모두 갖춰져 있다면, 매우 행복한 상황이다. 

1. 모든 시스템에 대해서 잘 알고 있는 똑똑하고 싹싹한 담당자가 옆에 붙어서 모든 질문에 대답을 해줄 수 있는 경우
2. 모니터링 도구가 있는 경우
3. 각종 로그가 잘 쌓여져 있는 경우

모니터링 도구나 트러블슈팅 시스템이 구축되어 있지 않다면, 각 장애 유형에 대해 진단할 수 있는 도구들을 통해서 진단해야한다.



#### 작업 흔적 남기기

이 단계의 작업을 수행할 때 중요한 것 중 하나는 작업의 흔적을 남기는 것이다. 
어떤 정보들을 확인했는지, 어떤 정보들이 의심이 되는지를 정리해 놓아야한다. 
이를 기반으로 장애 해결 결과를 공유할 수 있다.

> **🔍 작업의 흔적 남기기**
>
> 장애 사항을 깃허브 이슈로 남기고, 댓글로 흔적을 남긴다.



#### 장애 재현하기

찾아낸 부분이 문제점의 원인이라고 확신해서는 안된다. 가장 중요한 것은 장애를 재현하는 것이다.
"여기가 문제네요."가 "여기가 의심되는데 한번 확인해봐야겠네요." 보다 더 호의적이다.



#### 그래도 못 진단하지 못했다면?

- 팀 내에 있는 사수에게 문의
- 회사 내의 있는 기술지원팀에 문의
- OS와 WAS의 벤더에 요청하여 문제점을 찾아 달라고 문의
- 오픈 소스 서비스라면 구글링을 통해서 답을 찾기
- 전문 진단 컨설팅 업체에 문의



### 4. 장애 원인 제거하고 결과 정리하기

#### 장애 원인 제거

문제점의 원인을 정확하게 밝혀내고 재현이 가능한 경우, 전체 프로그램 수정으로 넘어간다.



#### 운영서버 확인

장애의 원인이라고 지목한 부분을 수정하였으면, 반드시 운영 서버에 문제가 없는지 확인하고, 장애가 정말 사라졌는지 지켜봐야한다.



#### 결과정리

*"다음에 동일한 문제를 겪을수도 있는 분들을 위해 이 작업은 필수다."*

장애의 원인을 제거하였다는 판단이 서면, 관련 팀이나 인원에게 이 사실을 통보하고 보고서 정리 작업을 수행한다. 

장애의 원인이라고 지목한 부분을 수정하여쓰면, 반드시 운영 서버에 문제가 없는지 확인하고, 장애가 정말 사라졌는지 지켜봐야 한다. 장애의 원인을 제거하였다는 판단이 서면, 관련 팀이나 인원에게 이 사실을 통보하고 보고서 정리 작업을 수행한다.



### 5. 진단 결과 보고서 작성 (필요할 경우)

#### 개요

- 장애의 증상과 시기

- 장애가 발생한 서버의 스펙과 사용 중인 소프트웨어의 버전

- 진단에 참여한 인원, 진단 기간, 사용한 도구

- 기타 각종 상황

#### 진단 내역 및 원인

- 가장 효과가 많은 부분부터 작성

- 진단은 했지만, 문제가 없었던 부분은 필요할 경우 작성

- 장애의 원인. 가능하다면, 진단의 절차와 문제가 된 소스 코드나 부분에 대한 로그 파일의 내용 포함

#### 해결 방안

- 반영 전과 후의 차이를 쉽게 확인할 수 있는 수치나 그래프

- 필요에 따라서는 수정한 소스 코드나, 수정 후 로그 파일의 내용

#### 종합 의견

- 진단 내역과 반영 결과를 한 장에 정리

#### 권고 사항

- 해당 장애와 많은 연관은 없지만, 문제가 될 수 있는 부분에 대한 정리
